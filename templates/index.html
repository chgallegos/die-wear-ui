<script>
  const form = document.getElementById("uploadForm");
  const fileInput = document.getElementById("fileInput");
  const analyzeBtn = document.getElementById("analyzeBtn");
  const btnText = document.getElementById("btnText");
  const dropzone = document.getElementById("dropzone");
  const fileMeta = document.getElementById("fileMeta");

  function setLoading(isLoading) {
    if (isLoading) {
      analyzeBtn.classList.add("loading");
      analyzeBtn.disabled = true;
      btnText.textContent = "Analyzing...";
    } else {
      analyzeBtn.classList.remove("loading");
      analyzeBtn.disabled = false;
      btnText.textContent = "Analyze Photo";
    }
  }

  function hasFile() {
    return fileInput.files && fileInput.files.length > 0;
  }

  function refreshButtonState() {
    analyzeBtn.disabled = !hasFile();
    const name = hasFile() ? fileInput.files[0].name : "none";
    fileMeta.innerHTML = `Selected: <b>${name}</b>`;
  }

  fileInput.addEventListener("change", refreshButtonState);
  window.addEventListener("load", refreshButtonState);

  form.addEventListener("submit", (e) => {
    if (!hasFile()) {
      e.preventDefault();
      alert("Please choose an image first.");
      return;
    }
    setLoading(true);
  });

  ["dragenter", "dragover"].forEach(evt => {
    dropzone.addEventListener(evt, (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropzone.classList.add("dragover");
    });
  });
  ["dragleave", "drop"].forEach(evt => {
    dropzone.addEventListener(evt, (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropzone.classList.remove("dragover");
    });
  });

  dropzone.addEventListener("drop", (e) => {
    const files = e.dataTransfer.files;
    if (!files || !files.length) return;
    fileInput.files = files;
    refreshButtonState();
    if (hasFile()) form.requestSubmit();
  });
</script>
